package com.zwad3.PseudoSocket;

import java.net.URI;
import java.util.Timer;
import java.util.TimerTask;

import org.java_websocket.client.WebSocketClient;
import org.java_websocket.handshake.ServerHandshake;

import android.util.Log;

public class PseudoSocketClient extends WebSocketClient {

	public  String host;
	public  String UID;
	public  String address;
	public  int    state;
	
	private int    tag      = 1;
	private Timer  tim;
	
	public int genTag() {
		return tag++;
	}
	
	public PseudoSocketClient(URI serverURI) {
		super(serverURI);
		Log.d("PSS","instantiated");
	}
	
	public void startHeartbeat() {
		if (tim == null) {
			tim = new Timer();
		} else {
			tim.cancel();
			tim = new Timer();
		}
		tim.scheduleAtFixedRate(new Heartbeat(this), 0, 30000);
	}

	public void stopHeartbeat() {
		if (tim != null) {
			tim.cancel();
			tim = null;
		}
	}
	@Override
	public void onClose(int arg0, String arg1, boolean arg2) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void onError(Exception arg0) {
		// TODO Auto-generated method stub
		Log.d("PSS",arg0.toString());
		
	}

	@Override
	public void onMessage(String arg0) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void onOpen(ServerHandshake arg0) {
		// TODO Auto-generated method stub
		Log.d("PSS","Opened");
		send("hi");
		
	}

	
	private class Heartbeat extends TimerTask {
		
		private WebSocketClient wc;
		
		public Heartbeat(WebSocketClient wc) {
			this.wc = wc;
		}
		
		@Override
		public void run() {
			wc.send("hrt");
		}
	}
}
